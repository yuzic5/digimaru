---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import FormattedDate from '../components/FormattedDate.astro';

// 1. Contentful から「blog」コレクションのデータをすべて取得
const allPosts = await getCollection('blog');

// 2. 日本語 (ja) の記事だけを抽出し、最新順（ID順）に並び替える
const posts = allPosts
	.filter(post => post.data.lang === 'ja')
	.sort((a, b) => b.id.localeCompare(a.id));
const latestPosts = allPosts
	.filter(post => post.data.lang === 'ja')
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3); // 最新の3件だけ表示
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main { width: 720px; max-width: calc(100% - 2em); margin: auto; padding: 2em 1em; }
			.hero-section { margin-bottom: 3rem; border-bottom: 1px solid #eee; padding-bottom: 2rem; }
			.memo-list { list-style-type: none; padding: 0; }
			.memo-item { margin-bottom: 1.5rem; }
			.memo-item a { text-decoration: none; color: #333; display: flex; flex-direction: column; }
			.memo-item .date { font-size: 0.8rem; color: #666; }
			.memo-item .title { font-size: 1.2rem; font-weight: bold; margin: 0.2rem 0; }
			.view-all { display: inline-block; margin-top: 1rem; color: var(--accent); font-weight: bold; }
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="hero-section">
				<h1>Astroを使ってブログを作ってみる</h1>
				<p>
					生成AIさんによりWeb検索が不要になりつつある今日この頃ではあるが、<br>
					そんな時代でもWeb上に情報発信していないという事は、<br>
					インターネットの世界では存在していないのと同義ではないか？<br>
					<br>
					自分が存在するため、<br>
					あわよくば、お世話になっているインターネットにも還元するため、<br>
					今更ながらブログをいうものを作ってみる。<br>
					<br>
					SNSの方が効果がありそうだが、<br>
					ソフトウェアエンジニアの端くれとして、<br>
					独自にホストしたWebページから情報発信してみたい、<br>
					でもお金はかけたくない、というノリで、<br>
					体調を崩した2026年元旦より作ってみた。<br>
					<br>
					今後どのような方向へ進んでいくかは未知数。<br>
					何かを誇示するでもなく、思うがままに、ふらふらと。<br>
				</p>
			</section>

			<section>
				<h2>Latest Memos</h2>
				<ul class="memo-list">
					{latestPosts.map((post) => (
						<li class="memo-item">
							<a href={`/ja/blog/${post.data.slug}/`}>
								<span class="date"><FormattedDate date={post.data.pubDate} /></span>
								<span class="title">{post.data.title}</span>
							</a>
						</li>
					))}
				</ul>
				<a href="/ja/blog/" class="view-all">全ての記事を見る →</a>
			</section>
		</main>
		<Footer />
	</body>
</html>