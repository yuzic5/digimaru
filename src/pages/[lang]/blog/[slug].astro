---
// src/pages/[lang]/blog/[slug].astro
import { getCollection } from 'astro:content';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';
import FormattedDate from '../../../components/FormattedDate.astro';

import BaseHead from '../../../components/BaseHead.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';


// 1. 全言語・全記事のパス（URL）を生成する
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { 
      lang: post.data.lang, // 'ja' または 'en'
      slug: post.data.slug  // 'contentful' など
    },
    props: { post },
  }));
}

const { post } = Astro.props;
const { lang } = Astro.params;

// 2. Contentful の Rich Text を HTML に変換
const htmlContent = documentToHtmlString(post.data.body);
---

<!doctype html>
<html lang={lang}>
	<head>
		<BaseHead title={post.data.title} description="" />
		<style>
			main {
				width: 720px;
				margin: auto;
				padding: 1em;
			}
			.content :global(p) {
				margin-bottom: 1.5em;
				line-height: 1.8;
			}
			.content :global(h2) {
				border-left: 5px solid #333;
				padding-left: 10px;
				margin-top: 2em;
			}
            /* 【修正】影を表示するためのスタイルを追加 */
            .hero-image {
                width: 100%;
                margin-bottom: 1em;
            }
            .hero-image img {
                display: block;
                margin: 0 auto;
                border-radius: 12px;
                /* スターターテンプレート定義の影を適用 */
                box-shadow: var(--box-shadow); 
            }
            .prose {
                width: 720px;
                max-width: calc(100% - 2em);
                margin: auto;
                padding: 1em;
                color: rgb(var(--gray-dark));
            }
            .date {
                margin-bottom: 0.5em;
                color: rgb(var(--gray));
            }
		</style>
	</head>
	<body>
        <Header />
        <main>
            <article class="prose">
                <div class="hero-image">
                    {post.data.heroImage && <img width={1020} height={510} src={post.data.heroImage} alt="" />}
                </div>
                <div class="title">
                    <div class="date">
                        <FormattedDate date={post.data.pubDate} />
                    </div>
                    <h1>{post.data.title}</h1>
                    <div>言語設定: {lang}</div>
                    <hr />
                </div>
                <div class="content" set:html={htmlContent} />
            </article>
        </main>
        <Footer />
    </body>
</html>